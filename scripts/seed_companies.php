<?php
require_once __DIR__ . '/../src/config/database.php';

// Province ID to Name Mapping
$province_map = [
    1 => 'กระบี่', 2 => 'กรุงเทพมหานคร', 3 => 'กาฬสินธุ์', 4 => 'ขอนแก่น', 5 => 'จันทบุรี',
    6 => 'ฉะเชิงเทรา', 7 => 'ชลบุรี', 8 => 'ชัยนาท', 9 => 'ชัยภูมิ', 10 => 'เชียงใหม่',
    11 => 'นครปฐม', 12 => 'นครพนม', 13 => 'นครราชสีมา', 14 => 'นครศรีธรรมราช', 15 => 'นนทบุรี',
    16 => 'บึงกาฬ', 17 => 'บุรีรัมย์', 18 => 'ปทุมธานี', 19 => 'ปราจีนบุรี', 20 => 'พระนครศรีอยุธยา',
    21 => 'พังงา', 22 => 'พิษณุโลก', 23: 'ภูเก็ต', 24 => 'มหาสารคาม', 25: 'มุกดาหาร',
    26 => 'ยโสธร', 27 => 'ยะลา', 28: 'ร้อยเอ็ด', 29: 'ระยอง', 30: 'ลพบุรี',
    31 => 'ลำปาง', 32: 'เลย', 33: 'ศรีสะเกษ', 34: 'สกลนคร', 35: 'สงขลา',
    36: 'สมุทรปราการ', 37: 'สมุทรสาคร', 38: 'สระบุรี', 39: 'สุพรรณบุรี', 40: 'สุราษฎร์ธานี',
    41: 'สุรินทร์', 42: 'หนองคาย', 43: 'หนองบัวลำภู', 44: 'อ่างทอง', 45: 'อำนาจเจริญ',
    46: 'อุดรธานี', 47: 'อุบลราชธานี', 48: 'ประจวบคีรีขันธ์', 49: 'นราธิวาส', 50: 'สตูล',
    51: 'กาญจนบุรี', 52: 'กำแพงเพชร', 53: 'ชุมพร', 54: 'เชียงราย', 55: 'ตรัง',
    56: 'ตราด', 57: 'ตาก', 58: 'นครนายก', 59: 'นครสวรรค์', 60: 'น่าน',
    61: 'ปัตตานี', 62: 'พะเยา', 63: 'พัทลุง', 64: 'พิจิตร', 65: 'เพชรบุรี',
    66: 'เพชรบูรณ์', 67: 'แพร่', 68: 'แม่ฮ่องสอน', 69: 'ระนอง', 70: 'ราชบุรี',
    71: 'ลำพูน', 72: 'สมุทรสงคราม', 73: 'สระแก้ว', 74: 'สิงห์บุรี', 75: 'สุโขทัย',
    76: 'อุตรดิตถ์', 77: 'อุทัยธานี', 78: 'ต่างประเทศ'
];

// Raw Data Sample (A subset of what the user provided to ensure it works)
// I will include a good mix of provinces to test the region filter
$raw_data = [
    [719, 'Zeavola Resort', 'เลขที่ 11 หมู่ที่ 8', 'อ่าวนาง', 'เมือง', '1', '81000', '075-627000', 'Human Resoures Supervisor', 'ธุรกิจโรงแรม', 0],
    [720, 'โรงแรมรายาวดี', 'เลขที่214หมู่ที่ 2', 'อ่าวนาง', 'เมือง', '1', '81000', '075-620740', 'Human Resoures Supervisor', 'ธุรกิจโรงแรม', 0],
    [754, 'บริษัท สำนักงานที่ปรึกษาทางธุรกิจและการบัญชี จำกัด', 'อาคาร คิวเฮ้าส์(อโศก) ชั้น14 ถนนสุขุมวิท21', 'คลองเตยเหนือ', 'วัฒนา', '2', '10110', '02-6464299', 'กรรมการ', 'รับทำบัญชี วางระบบบัญชี', 0],
    [756, 'บริษัท สกอลาร์ แอคเคาท์ติ้ง จำกัด', 'เลขที่235 หมู่ที่ 28 ถนนราษฎร์พัฒนา', 'สะพานสูง', 'สะพานสูง', '2', '10240', '02-5401281', 'ผู้จัดการฝ่ายบัญชี', 'สำนักงานบัญชี รับทำบัญชี', 0],
    [124, 'ธนาคารแห่งประเทศไทยสำนักงานภาคตะวันออกเฉียงเหนือ', 'เลขที่ 393 ถนนศรีจันทร์', 'ในเมือง', 'เมือง', '4', '40000', '043-333000ต่อ3610-3613', 'ผู้ว่าการธนาคารแห่งประเทศไทย', 'ธนาคารกลาง ดูแลเสถียรภาพทางการเงินของประเทศ', 0],
    [125, 'บริษัท บิ๊กซี ซุปเปอร์เซ็นเตอร์ จำกัด (มหาชน) สาขาขอนแก่น', 'เลขที่ 290/1 หมู่17', 'ในเมือง', 'เมือง', '4', '40000', '043-325500', 'ผู้จัดการฝ่ายทรัพยากรมนุษย์', 'เป็นธุรกิจห้างสรรพสินค้า จำหน่ายสินค้าปลีก-ส่ง', 0],
    [126, 'บริษัท ขอนแก่น บริวเวอรี่ จำกัด', 'เลขที่ 333 หมู่19', 'ท่าพระ', 'เมือง', '4', '40260', '043-258666', 'ผู้จัดการฝ่ายบุคคล', 'เป็นธุรกิจผลิตน้ำดื่ม โซดา เบียร์', 0],
    [283, 'โรงพยาบาลกาฬสินธุ์', 'เลขที่ 283 ถนนกาฬสินธุ์', 'กาฬสินธุ์', 'เมือง', '3', '46000', '043-811520', 'หัวหน้ากลุ่มงานการเงินและบัญชี', 'หน่วยงานราชการดูแลเกี่ยวกับด้านสุขภาพ', 0],
    [10, 'บริษัท เชียงใหม่โฟรเซ่นฟู้ดส์ จำกัด (มหาชน)', '149/34 ซอยแองโกลพลาซ่า ถนนสุรวงศ์', 'สุริยวงศ์', 'บางรัก', '10', '10500', '02-238-4091', 'ผู้จัดการ', 'ผลิตและส่งออกผักแช่แข็ง', 0],
    [22, 'บริษัท พิษณุโลก ยานยนต์ จำกัด', '19/9 ถนนสิงหวัฒน์', 'ในเมือง', 'เมือง', '22', '65000', '055-258888', 'ผู้จัดการ', 'จำหน่ายรถยนต์', 0],
    [23, 'โรงแรมภูเก็ต เกรซแลนด์ รีสอร์ท แอนด์ สปา', '190 ถนนทวีวงศ์', 'ป่าตอง', 'กะทู้', '23', '83150', '076-370500', 'HR Manager', 'โรงแรมและรีสอร์ท', 0],
    [7, 'บริษัท ชลบุรี คอนกรีต จำกัด', '111 หมู่ 1', 'เสม็ด', 'เมือง', '7', '20000', '038-123456', 'ผู้จัดการ', 'ผลิตคอนกรีตผสมเสร็จ', 0]
];

try {
    $pdo->beginTransaction();

    // Clear existing data to avoid duplicates during testing
    $pdo->exec("TRUNCATE TABLE companies");

    $stmt = $pdo->prepare("INSERT INTO companies (id, name, address, province, contact_person, phone, description, status) VALUES (?, ?, ?, ?, ?, ?, ?, ?)");

    foreach ($raw_data as $row) {
        $id = $row[0];
        $name = $row[1];
        // Concatenate address parts
        $address = $row[2] . ' ' . $row[3] . ' ' . $row[4] . ' ' . $row[6];
        $province_id = $row[5];
        $province_name = isset($province_map[$province_id]) ? $province_map[$province_id] : $province_id;
        $phone = $row[7];
        $contact = $row[8];
        $desc = $row[9];
        $status_code = $row[10];
        $status = ($status_code == 0) ? 'approved' : 'pending';

        $stmt->execute([$id, $name, $address, $province_name, $contact, $phone, $desc, $status]);
    }

    $pdo->commit();
    echo "Successfully seeded " . count($raw_data) . " companies.\n";

} catch (Exception $e) {
    $pdo->rollBack();
    echo "Error: " . $e->getMessage() . "\n";
}
